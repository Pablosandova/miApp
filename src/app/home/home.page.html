<ion-header [translucent]="true" class="modern-header">
  <ion-toolbar>
    <ion-title class="ion-text-center">
      Elite Performance
    </ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/saludo">
        <ion-icon name="hand-left-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button routerLink="/upload-image">
        <ion-icon name="camera-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button routerLink="/registro-diario">
        <ion-icon name="checkmark-done-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button routerLink="/rutinas">
        <ion-icon name="barbell-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button routerLink="/agregar">
        <ion-icon name="person-add-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  
  <!-- Usuario Selector Compacto -->
  <ion-toolbar *ngIf="usuarios.length > 0" class="usuario-toolbar-compact">
    <div class="usuario-selector-compact">
      <div class="current-user">
        <ion-icon name="person-circle"></ion-icon>
        <span class="user-name">{{ usuarioSeleccionado?.nombre || 'Seleccionar' }}</span>
      </div>
    </div>
    
    <!-- Selector de usuario en dropdown -->
    <div class="user-chips">
      <ion-button 
        *ngFor="let usuario of usuarios"
        [fill]="usuarioSeleccionado?.nombre === usuario.nombre ? 'solid' : 'outline'"
        [color]="usuarioSeleccionado?.nombre === usuario.nombre ? 'secondary' : 'medium'"
        size="small"
        (click)="cambiarUsuario(usuario)"
        class="user-chip">
        {{ usuario.nombre }}
      </ion-button>
    </div>
  </ion-toolbar>

  <!-- Mensaje cuando no hay usuarios -->
  <ion-toolbar *ngIf="usuarios.length === 0" class="no-users-compact">
    <div class="welcome-message">
      <ion-icon name="fitness-outline"></ion-icon>
      <span>Crea tu perfil para empezar</span>
    </div>
  </ion-toolbar>

  <!-- Stats del Usuario - Compacto -->
  <ion-toolbar *ngIf="usuarioSeleccionado" class="stats-toolbar">
    <div class="stats-compact">
      <div class="stat-item">
        <ion-icon name="calendar-outline"></ion-icon>
        <span>{{ usuarioSeleccionado.edad }}a</span>
      </div>
      <div class="stat-item">
        <ion-icon name="scale-outline"></ion-icon>
        <span>{{ usuarioSeleccionado.peso }}kg</span>
      </div>
      <div class="stat-item">
        <ion-icon name="resize-outline"></ion-icon>
        <span>{{ usuarioSeleccionado.estatura }}cm</span>
      </div>
      <div class="stat-item highlight">
        <ion-icon name="analytics-outline"></ion-icon>
        <span>IMC {{ (usuarioSeleccionado.peso / ((usuarioSeleccionado.estatura / 100) * (usuarioSeleccionado.estatura / 100))).toFixed(1) }}</span>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-content">
  <!-- Hero Section Simplificado -->
  <div class="hero-compact">
    <div class="hero-gradient"></div>
    <div class="hero-content-compact">
      <h1>Tu Entrenamiento Elite</h1>
      <p>Planes personalizados de Jiu-Jitsu, nutrición y ejercicio</p>
    </div>
  </div>

  <!-- Tabs de Navegación -->
  <div class="tabs-container">
    <div class="tabs-scroll">
      <div 
        class="tab-item" 
        [class.active]="selectedSegment === 'jiujitsu'"
        (click)="selectedSegment = 'jiujitsu'">
        <ion-icon name="trophy-outline"></ion-icon>
        <span>Jiu-Jitsu</span>
      </div>
      <div 
        class="tab-item" 
        [class.active]="selectedSegment === 'nutricion'"
        (click)="selectedSegment = 'nutricion'">
        <ion-icon name="nutrition-outline"></ion-icon>
        <span>Nutrición</span>
      </div>
      <div 
        class="tab-item" 
        [class.active]="selectedSegment === 'ejercicio'"
        (click)="selectedSegment = 'ejercicio'">
        <ion-icon name="barbell-outline"></ion-icon>
        <span>Ejercicio</span>
      </div>
    </div>
  </div>

  <!-- Sección de Jiu-Jitsu -->
  <div *ngIf="selectedSegment === 'jiujitsu'" class="content-section">
    <div class="section-title">
      <h2>Técnicas de Jiu-Jitsu</h2>
      <span class="badge-count">{{ tecnicasJiujitsu.length }}</span>
    </div>

    <div class="cards-grid">
      <ion-card *ngFor="let tecnica of tecnicasJiujitsu" class="content-card">
        <div class="card-image">
          <img 
            [src]="tecnica.imagen" 
            [alt]="tecnica.nombre"
            (error)="onImageError($event)"
          />
          <div class="card-badge" [class]="tecnica.nivel.toLowerCase()">
            {{ tecnica.nivel }}
          </div>
        </div>
        <div class="card-body">
          <h3>{{ tecnica.nombre }}</h3>
          <p class="card-desc">{{ tecnica.descripcion }}</p>
          <div class="card-meta">
            <span class="meta-item">
              <ion-icon name="time-outline"></ion-icon>
              {{ tecnica.duracion }} min
            </span>
            <span class="meta-item">
              <ion-icon name="flame-outline"></ion-icon>
              {{ tecnica.calorias }} cal
            </span>
          </div>
          <ion-button 
            expand="block" 
            fill="clear" 
            class="card-action">
            Ver Detalles
            <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
          </ion-button>
        </div>
      </ion-card>
    </div>
  </div>

  <!-- Sección de Nutrición -->
  <div *ngIf="selectedSegment === 'nutricion'" class="content-section">
    <div *ngIf="!usuarioSeleccionado" class="empty-state">
      <ion-icon name="person-add-outline"></ion-icon>
      <h3>Crea tu perfil</h3>
      <p>Necesitas seleccionar un usuario para ver planes nutricionales personalizados</p>
      <ion-button routerLink="/agregar" color="primary">
        Crear Perfil
      </ion-button>
    </div>

    <div *ngIf="usuarioSeleccionado">
      <div class="section-title">
        <h2>Planes Nutricionales</h2>
        <span class="badge-count">{{ planesNutricionales.length }}</span>
      </div>

      <div class="cards-grid">
        <ion-card *ngFor="let plan of planesNutricionales" class="content-card nutrition-card">
          <div class="card-body">
            <div class="nutrition-header">
              <h3>{{ plan.titulo }}</h3>
              <span class="calories-badge">
                <ion-icon name="flame"></ion-icon>
                {{ calcularCaloriasPersonalizadas(plan.calorias, usuarioSeleccionado) }} cal
              </span>
            </div>
            <p class="card-desc">{{ plan.descripcion }}</p>
            
            <div class="macros-grid">
              <div class="macro-item">
                <div class="macro-icon protein">
                  <ion-icon name="fitness-outline"></ion-icon>
                </div>
                <span class="macro-value">{{ plan.proteinas }}g</span>
                <span class="macro-label">Proteína</span>
              </div>
              <div class="macro-item">
                <div class="macro-icon carbs">
                  <ion-icon name="leaf-outline"></ion-icon>
                </div>
                <span class="macro-value">{{ plan.carbohidratos }}g</span>
                <span class="macro-label">Carbos</span>
              </div>
              <div class="macro-item">
                <div class="macro-icon fats">
                  <ion-icon name="water-outline"></ion-icon>
                </div>
                <span class="macro-value">{{ plan.grasas }}g</span>
                <span class="macro-label">Grasas</span>
              </div>
            </div>

            <div class="card-footer">
              <span class="time-info">
                <ion-icon name="timer-outline"></ion-icon>
                {{ plan.tiempo }} min prep
              </span>
              <ion-button fill="clear" size="small">
                Ver Receta
                <ion-icon name="arrow-forward-outline" slot="end"></ion-icon>
              </ion-button>
            </div>
          </div>
        </ion-card>
      </div>
    </div>
  </div>

  <!-- Sección de Ejercicio -->
  <div *ngIf="selectedSegment === 'ejercicio'" class="content-section">
    <div class="section-title">
      <h2>Rutinas de Ejercicio</h2>
      <span class="badge-count">{{ rutinasEjercicio.length }}</span>
    </div>

    <div class="cards-grid">
      <ion-card *ngFor="let rutina of rutinasEjercicio" class="content-card exercise-card">
        <div class="card-image">
          <img 
            [src]="rutina.imagen" 
            [alt]="rutina.nombre"
            (error)="onImageError($event)"
          />
          <div class="intensity-badge" [class]="rutina.intensidad.toLowerCase()">
            {{ rutina.intensidad }}
          </div>
        </div>
        <div class="card-body">
          <h3>{{ rutina.nombre }}</h3>
          <span class="routine-type">{{ rutina.tipo }}</span>
          <p class="card-desc">{{ rutina.descripcion }}</p>
          
          <div class="routine-stats">
            <div class="stat">
              <ion-icon name="time-outline"></ion-icon>
              <span>{{ rutina.duracion }} min</span>
            </div>
            <div class="stat">
              <ion-icon name="flame-outline"></ion-icon>
              <span>{{ rutina.calorias }} cal</span>
            </div>
            <div class="stat">
              <ion-icon name="barbell-outline"></ion-icon>
              <span>{{ rutina.ejercicios }} ejercicios</span>
            </div>
          </div>

          <ion-button 
            expand="block" 
            class="start-routine-btn"
            (click)="iniciarRutina(rutina)">
            <ion-icon name="play-outline" slot="start"></ion-icon>
            Iniciar Rutina
          </ion-button>
        </div>
      </ion-card>
    </div>
  </div>
</ion-content>
