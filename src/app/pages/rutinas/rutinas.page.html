<ion-header [translucent]="true" class="modern-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Gestión de Rutinas</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="modern-content">
  <!-- Vista de Detalle de Rutina -->
  <div *ngIf="viendoRutina" class="detail-overlay">
    <ion-card class="detail-card">
      <ion-card-header>
        <div class="detail-header">
          <ion-card-title>{{ viendoRutina.nombre }}</ion-card-title>
          <ion-button fill="clear" (click)="cerrarVistaRutina()">
            <ion-icon name="close-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
        <div class="badges">
          <span class="badge" [attr.color]="getColorTipo(viendoRutina.tipo)">{{ viendoRutina.tipo }}</span>
          <span class="badge" [attr.color]="getColorNivel(viendoRutina.nivel)">{{ viendoRutina.nivel }}</span>
          <span class="badge">{{ viendoRutina.duracion }} min</span>
        </div>
      </ion-card-header>
      <ion-card-content>
        <div class="detail-section">
          <h3><ion-icon name="information-circle-outline"></ion-icon> Descripción</h3>
          <p>{{ viendoRutina.descripcion }}</p>
        </div>
        
        <div class="detail-section">
          <h3><ion-icon name="barbell-outline"></ion-icon> Ejercicios ({{ viendoRutina.ejercicios.length }})</h3>
          <ol class="exercise-list">
            <li *ngFor="let ejercicio of viendoRutina.ejercicios">{{ ejercicio }}</li>
          </ol>
        </div>

        <div class="button-group">
          <ion-button expand="block" (click)="editarRutina(viendoRutina)">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Editar
          </ion-button>
          <ion-button expand="block" color="danger" (click)="eliminarRutina(viendoRutina.id)">
            <ion-icon name="trash-outline" slot="start"></ion-icon>
            Eliminar
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Formulario de Crear/Editar Rutina -->
  <div class="form-section">
    <div class="section-header">
      <h2>{{ modoEdicion ? 'Editar Rutina' : 'Nueva Rutina' }}</h2>
      <p>{{ modoEdicion ? 'Actualiza los datos de la rutina' : 'Crea una rutina de ejercicios personalizada' }}</p>
    </div>

    <form (ngSubmit)="guardarRutina()" class="rutina-form">
      <!-- Nombre -->
      <div class="form-group">
        <ion-label class="form-label">
          <ion-icon name="fitness-outline" slot="start"></ion-icon>
          Nombre de la Rutina
        </ion-label>
        <ion-input
          [(ngModel)]="formulario.nombre"
          name="nombre"
          placeholder="Ej: Entrenamiento Full Body"
          class="modern-input"
          required>
        </ion-input>
      </div>

      <!-- Tipo y Duración -->
      <div class="form-row">
        <div class="form-group half-width">
          <ion-label class="form-label">
            <ion-icon name="pulse-outline" slot="start"></ion-icon>
            Tipo
          </ion-label>
          <ion-select
            [(ngModel)]="formulario.tipo"
            name="tipo"
            interface="popover"
            class="modern-select">
            <ion-select-option *ngFor="let tipo of tiposRutina" [value]="tipo">
              {{ tipo }}
            </ion-select-option>
          </ion-select>
        </div>

        <div class="form-group half-width">
          <ion-label class="form-label">
            <ion-icon name="time-outline" slot="start"></ion-icon>
            Duración (min)
          </ion-label>
          <ion-input
            [(ngModel)]="formulario.duracion"
            name="duracion"
            type="number"
            placeholder="45"
            class="modern-input"
            required>
          </ion-input>
        </div>
      </div>

      <!-- Nivel -->
      <div class="form-group">
        <ion-label class="form-label">
          <ion-icon name="trophy-outline" slot="start"></ion-icon>
          Nivel
        </ion-label>
        <ion-select
          [(ngModel)]="formulario.nivel"
          name="nivel"
          interface="popover"
          class="modern-select">
          <ion-select-option *ngFor="let nivel of niveles" [value]="nivel">
            {{ nivel }}
          </ion-select-option>
        </ion-select>
      </div>

      <!-- Descripción -->
      <div class="form-group">
        <ion-label class="form-label">
          <ion-icon name="document-text-outline" slot="start"></ion-icon>
          Descripción
        </ion-label>
        <ion-textarea
          [(ngModel)]="formulario.descripcion"
          name="descripcion"
          placeholder="Describe el objetivo y características de esta rutina..."
          rows="3"
          class="modern-textarea"
          required>
        </ion-textarea>
      </div>

      <!-- Ejercicios -->
      <div class="form-group">
        <ion-label class="form-label">
          <ion-icon name="list-outline" slot="start"></ion-icon>
          Ejercicios (uno por línea)
        </ion-label>
        <ion-textarea
          [(ngModel)]="formulario.ejercicios"
          name="ejercicios"
          placeholder="Sentadillas 3x12&#10;Press de banca 3x10&#10;Peso muerto 3x8&#10;Plancha 3x30seg"
          rows="6"
          class="modern-textarea">
        </ion-textarea>
      </div>

      <!-- Botones -->
      <div class="button-group">
        <ion-button
          type="submit"
          expand="block"
          size="large"
          class="submit-btn"
          [disabled]="!formulario.nombre || !formulario.duracion || !formulario.descripcion">
          <ion-icon [name]="modoEdicion ? 'save-outline' : 'add-circle-outline'" slot="start"></ion-icon>
          {{ modoEdicion ? 'Actualizar Rutina' : 'Crear Rutina' }}
        </ion-button>
        
        <ion-button
          *ngIf="modoEdicion"
          expand="block"
          size="large"
          color="medium"
          (click)="cancelarEdicion()">
          <ion-icon name="close-outline" slot="start"></ion-icon>
          Cancelar
        </ion-button>
      </div>
    </form>
  </div>

  <!-- Mensaje de ayuda -->
  <div class="help-section">
    <ion-card class="help-card">
      <ion-card-content>
        <div class="help-content">
          <ion-icon name="information-circle-outline"></ion-icon>
          <p>Después de crear una rutina, puedes verla en la sección <strong>"Listar"</strong> del menú principal.</p>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
